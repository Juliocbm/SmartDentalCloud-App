<div class="autocomplete-container">
  <label class="autocomplete-label">
    <ng-content></ng-content>
    @if (required) {
      <span class="required">*</span>
    }
  </label>

  <div class="autocomplete-input-wrapper">
    <input
      type="text"
      [formControl]="searchControl"
      [placeholder]="placeholder"
      [disabled]="disabled"
      (focus)="onFocus()"
      (blur)="onBlur()"
      class="autocomplete-input"
      [class.error]="error"
      [class.has-value]="selectedService()"
    />

    @if (loading()) {
      <i class="fa-solid fa-spinner fa-spin autocomplete-icon"></i>
    } @else if (selectedService()) {
      <button
        type="button"
        (click)="clearSelection()"
        class="autocomplete-clear"
        title="Limpiar selecciÃ³n"
      >
        <i class="fa-solid fa-times"></i>
      </button>
    } @else {
      <i class="fa-solid fa-search autocomplete-icon"></i>
    }

    @if (showDropdown() && filteredServices().length > 0) {
      <div class="autocomplete-dropdown">
        @for (service of filteredServices(); track service.id) {
          <button
            type="button"
            class="autocomplete-item"
            (click)="selectService(service)"
          >
            <div class="service-info">
              <div class="service-name">{{ service.name }}</div>
              <div class="service-details">
                <span class="service-price">{{ formatCurrency(service.cost) }}</span>
                @if (service.durationMinutes) {
                  <span class="service-duration">
                    <i class="fa-solid fa-clock"></i>
                    {{ service.durationMinutes }} min
                  </span>
                }
                @if (service.claveProdServ) {
                  <span class="service-sat">
                    <i class="fa-solid fa-barcode"></i>
                    {{ service.claveProdServ }}
                  </span>
                }
              </div>
            </div>
          </button>
        }
      </div>
    }

    @if (showDropdown() && !loading() && filteredServices().length === 0 && searchControl.value && searchControl.value.length >= 1) {
      <div class="autocomplete-dropdown">
        <div class="autocomplete-empty">
          <i class="fa-solid fa-tooth"></i>
          <span>No se encontraron servicios</span>
        </div>
      </div>
    }
  </div>

  @if (error) {
    <span class="error-message">{{ error }}</span>
  }
</div>
