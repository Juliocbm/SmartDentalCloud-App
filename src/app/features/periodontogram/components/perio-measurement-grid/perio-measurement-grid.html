<div class="perio-grid" tabindex="0">

  <!-- Jaw View Tabs -->
  <nav class="jaw-tabs">
    @for (tab of jawTabs; track tab.key) {
      <button
        class="jaw-tab"
        [class.jaw-tab--active]="activeJaw() === tab.key"
        (click)="setJawView(tab.key)">
        <i class="fa-solid" [ngClass]="tab.icon"></i>
        {{ tab.label }}
      </button>
    }
  </nav>

  <!-- ============ UPPER JAW ============ -->
  @if (activeJaw() === 'upper' || activeJaw() === 'all') {
  <section class="jaw-section upper-jaw">
    @if (activeJaw() === 'all') {
      <h4 class="jaw-title">
        <i class="fa-solid fa-arrow-up"></i>
        Maxilar Superior
      </h4>
    }

    <!-- Upper Buccal/Vestibular Table -->
    <div class="surface-label">Vestibular</div>
    <div class="grid-table-wrapper">
      <table class="grid-table">
        <thead>
          <tr class="tooth-numbers-row">
            <th class="row-label-cell"></th>
            @for (tn of UPPER_TEETH; track tn; let i = $index) {
              <th colspan="3" class="tooth-header"
                [class.quadrant-divider]="i === 8"
                [class.tooth-missing]="getToothByNumber(tn)?.isMissing">
                <span class="th-num">{{ tn }}</span>
              </th>
            }
          </tr>
        </thead>
        <tbody>
          <!-- PD Row -->
          <tr class="data-row">
            <td class="row-label-cell">PD</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  [class.active-cell]="isCellActive(ti, si, 'pd', 'buccal', 'upper')"
                  (click)="focusCell(ti, si, 'pd', 'buccal', 'upper')">
                  @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                    <input type="number" min="0" max="15"
                      class="site-input"
                      [class]="getPDClass(getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'pd'))"
                      [id]="getCellId('upper', 'buccal', ti, si, 'pd')"
                      [value]="getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'pd')"
                      (input)="onNumericInput($event, getToothByNumber(tn)!, 'buccal', si, 'pd')"
                      (focus)="focusCell(ti, si, 'pd', 'buccal', 'upper')"/>
                  } @else {
                    <span class="site-value" [class]="getPDClass(getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'pd'))">
                      {{ getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'pd') ?? '' }}
                    </span>
                  }
                </td>
              }
            }
          </tr>
          <!-- GM Row -->
          <tr class="data-row">
            <td class="row-label-cell">Margen</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  [class.active-cell]="isCellActive(ti, si, 'gm', 'buccal', 'upper')"
                  (click)="focusCell(ti, si, 'gm', 'buccal', 'upper')">
                  @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                    <input type="number" min="-10" max="10"
                      class="site-input"
                      [id]="getCellId('upper', 'buccal', ti, si, 'gm')"
                      [value]="getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'gm')"
                      (input)="onNumericInput($event, getToothByNumber(tn)!, 'buccal', si, 'gm')"
                      (focus)="focusCell(ti, si, 'gm', 'buccal', 'upper')"/>
                  } @else {
                    <span class="site-value">
                      {{ getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'gm') ?? '' }}
                    </span>
                  }
                </td>
              }
            }
          </tr>
          <!-- CAL Row (auto-calculated, readonly) -->
          <tr class="data-row cal-row">
            <td class="row-label-cell">NIC</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0">
                  <span class="site-value" [class]="getCALClass(getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'cal'))">
                    {{ getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'cal') ?? '' }}
                  </span>
                </td>
              }
            }
          </tr>
          <!-- Bleeding Row -->
          <tr class="data-row bool-row">
            <td class="row-label-cell">Sangr.</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell bool-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  (click)="toggleBool(getToothByNumber(tn)!, 'buccal', si, 'bleeding')">
                  <span class="bool-dot"
                    [class.bleeding-active]="getSiteBoolValue(getToothByNumber(tn)!, 'buccal', si, 'bleeding')">
                  </span>
                </td>
              }
            }
          </tr>
          <!-- Suppuration Row -->
          <tr class="data-row bool-row">
            <td class="row-label-cell">Exud.</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell bool-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  (click)="toggleBool(getToothByNumber(tn)!, 'buccal', si, 'suppuration')">
                  <span class="bool-dot"
                    [class.suppuration-active]="getSiteBoolValue(getToothByNumber(tn)!, 'buccal', si, 'suppuration')">
                  </span>
                </td>
              }
            }
          </tr>
          <!-- Mobility Row -->
          <tr class="data-row extra-row">
            <td class="row-label-cell">Movil.</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              <td colspan="3" class="tooth-extra-cell"
                [class.quadrant-divider-cell]="ti === 8">
                @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                  <input type="number" min="0" max="3"
                    class="extra-input"
                    [value]="getToothByNumber(tn)!.mobility"
                    (input)="onMobilityChange($event, getToothByNumber(tn)!)"/>
                } @else {
                  <span class="extra-value">{{ getToothByNumber(tn)?.mobility ?? '' }}</span>
                }
              </td>
            }
          </tr>
          <!-- Furcation Row -->
          <tr class="data-row extra-row">
            <td class="row-label-cell">Furca.</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              <td colspan="3" class="tooth-extra-cell"
                [class.quadrant-divider-cell]="ti === 8">
                @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                  <input type="number" min="0" max="3"
                    class="extra-input"
                    [value]="getToothByNumber(tn)!.furcation"
                    (input)="onFurcationChange($event, getToothByNumber(tn)!)"/>
                } @else {
                  <span class="extra-value">{{ getToothByNumber(tn)?.furcation ?? '' }}</span>
                }
              </td>
            }
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Upper Tooth Charts -->
    <div class="charts-between-tables">
      <div class="chart-surface-section">
        <span class="chart-label">Vestibular</span>
        <app-perio-tooth-chart
          [teeth]="teeth"
          [selectedTooth]="selectedTooth"
          surface="buccal"
          jaw="upper"
          (toothSelected)="toothSelected.emit($event)"/>
      </div>
      <div class="chart-surface-section">
        <span class="chart-label">Palatino</span>
        <app-perio-tooth-chart
          [teeth]="teeth"
          [selectedTooth]="selectedTooth"
          surface="lingual"
          jaw="upper"
          (toothSelected)="toothSelected.emit($event)"/>
      </div>
    </div>

    <!-- Upper Lingual / Palatino Table -->
    <div class="surface-label">Lingual / Palatino</div>
    <div class="grid-table-wrapper">
      <table class="grid-table">
        <thead>
          <tr class="tooth-numbers-row">
            <th class="row-label-cell"></th>
            @for (tn of UPPER_TEETH; track tn; let i = $index) {
              <th colspan="3" class="tooth-header"
                [class.quadrant-divider]="i === 8"
                [class.tooth-missing]="getToothByNumber(tn)?.isMissing">
                <span class="th-num">{{ tn }}</span>
              </th>
            }
          </tr>
        </thead>
        <tbody>
          <!-- PD Row Lingual -->
          <tr class="data-row">
            <td class="row-label-cell">PD</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  [class.active-cell]="isCellActive(ti, si, 'pd', 'lingual', 'upper')"
                  (click)="focusCell(ti, si, 'pd', 'lingual', 'upper')">
                  @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                    <input type="number" min="0" max="15"
                      class="site-input"
                      [class]="getPDClass(getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'pd'))"
                      [id]="getCellId('upper', 'lingual', ti, si, 'pd')"
                      [value]="getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'pd')"
                      (input)="onNumericInput($event, getToothByNumber(tn)!, 'lingual', si, 'pd')"
                      (focus)="focusCell(ti, si, 'pd', 'lingual', 'upper')"/>
                  } @else {
                    <span class="site-value" [class]="getPDClass(getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'pd'))">
                      {{ getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'pd') ?? '' }}
                    </span>
                  }
                </td>
              }
            }
          </tr>
          <!-- GM Row Lingual -->
          <tr class="data-row">
            <td class="row-label-cell">Margen</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  [class.active-cell]="isCellActive(ti, si, 'gm', 'lingual', 'upper')"
                  (click)="focusCell(ti, si, 'gm', 'lingual', 'upper')">
                  @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                    <input type="number" min="-10" max="10"
                      class="site-input"
                      [id]="getCellId('upper', 'lingual', ti, si, 'gm')"
                      [value]="getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'gm')"
                      (input)="onNumericInput($event, getToothByNumber(tn)!, 'lingual', si, 'gm')"
                      (focus)="focusCell(ti, si, 'gm', 'lingual', 'upper')"/>
                  } @else {
                    <span class="site-value">
                      {{ getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'gm') ?? '' }}
                    </span>
                  }
                </td>
              }
            }
          </tr>
          <!-- CAL Row Lingual -->
          <tr class="data-row cal-row">
            <td class="row-label-cell">NIC</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0">
                  <span class="site-value" [class]="getCALClass(getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'cal'))">
                    {{ getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'cal') ?? '' }}
                  </span>
                </td>
              }
            }
          </tr>
          <!-- Bleeding Row Lingual -->
          <tr class="data-row bool-row">
            <td class="row-label-cell">Sangr.</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell bool-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  (click)="toggleBool(getToothByNumber(tn)!, 'lingual', si, 'bleeding')">
                  <span class="bool-dot"
                    [class.bleeding-active]="getSiteBoolValue(getToothByNumber(tn)!, 'lingual', si, 'bleeding')">
                  </span>
                </td>
              }
            }
          </tr>
          <!-- Suppuration Row Lingual -->
          <tr class="data-row bool-row">
            <td class="row-label-cell">Exud.</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell bool-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  (click)="toggleBool(getToothByNumber(tn)!, 'lingual', si, 'suppuration')">
                  <span class="bool-dot"
                    [class.suppuration-active]="getSiteBoolValue(getToothByNumber(tn)!, 'lingual', si, 'suppuration')">
                  </span>
                </td>
              }
            }
          </tr>
          <!-- Mobility Row Lingual -->
          <tr class="data-row extra-row">
            <td class="row-label-cell">Movil.</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              <td colspan="3" class="tooth-extra-cell"
                [class.quadrant-divider-cell]="ti === 8">
                @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                  <input type="number" min="0" max="3"
                    class="extra-input"
                    [value]="getToothByNumber(tn)!.mobility"
                    (input)="onMobilityChange($event, getToothByNumber(tn)!)"/>
                } @else {
                  <span class="extra-value">{{ getToothByNumber(tn)?.mobility ?? '' }}</span>
                }
              </td>
            }
          </tr>
          <!-- Furcation Row Lingual -->
          <tr class="data-row extra-row">
            <td class="row-label-cell">Furca.</td>
            @for (tn of UPPER_TEETH; track tn; let ti = $index) {
              <td colspan="3" class="tooth-extra-cell"
                [class.quadrant-divider-cell]="ti === 8">
                @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                  <input type="number" min="0" max="3"
                    class="extra-input"
                    [value]="getToothByNumber(tn)!.furcation"
                    (input)="onFurcationChange($event, getToothByNumber(tn)!)"/>
                } @else {
                  <span class="extra-value">{{ getToothByNumber(tn)?.furcation ?? '' }}</span>
                }
              </td>
            }
          </tr>
        </tbody>
      </table>
    </div>
  </section>
  }

  <!-- ============ LOWER JAW ============ -->
  @if (activeJaw() === 'lower' || activeJaw() === 'all') {
  <section class="jaw-section lower-jaw">
    @if (activeJaw() === 'all') {
      <h4 class="jaw-title">
        <i class="fa-solid fa-arrow-down"></i>
        Maxilar Inferior
      </h4>
    }

    <!-- Lower Vestibular Table -->
    <div class="surface-label">Vestibular</div>
    <div class="grid-table-wrapper">
      <table class="grid-table">
        <thead>
          <tr class="tooth-numbers-row">
            <th class="row-label-cell"></th>
            @for (tn of LOWER_TEETH; track tn; let i = $index) {
              <th colspan="3" class="tooth-header"
                [class.quadrant-divider]="i === 8"
                [class.tooth-missing]="getToothByNumber(tn)?.isMissing">
                <span class="th-num">{{ tn }}</span>
              </th>
            }
          </tr>
        </thead>
        <tbody>
          <tr class="data-row">
            <td class="row-label-cell">PD</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  [class.active-cell]="isCellActive(ti, si, 'pd', 'buccal', 'lower')"
                  (click)="focusCell(ti, si, 'pd', 'buccal', 'lower')">
                  @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                    <input type="number" min="0" max="15"
                      class="site-input"
                      [class]="getPDClass(getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'pd'))"
                      [id]="getCellId('lower', 'buccal', ti, si, 'pd')"
                      [value]="getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'pd')"
                      (input)="onNumericInput($event, getToothByNumber(tn)!, 'buccal', si, 'pd')"
                      (focus)="focusCell(ti, si, 'pd', 'buccal', 'lower')"/>
                  } @else {
                    <span class="site-value" [class]="getPDClass(getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'pd'))">
                      {{ getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'pd') ?? '' }}
                    </span>
                  }
                </td>
              }
            }
          </tr>
          <tr class="data-row">
            <td class="row-label-cell">Margen</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  [class.active-cell]="isCellActive(ti, si, 'gm', 'buccal', 'lower')"
                  (click)="focusCell(ti, si, 'gm', 'buccal', 'lower')">
                  @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                    <input type="number" min="-10" max="10"
                      class="site-input"
                      [id]="getCellId('lower', 'buccal', ti, si, 'gm')"
                      [value]="getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'gm')"
                      (input)="onNumericInput($event, getToothByNumber(tn)!, 'buccal', si, 'gm')"
                      (focus)="focusCell(ti, si, 'gm', 'buccal', 'lower')"/>
                  } @else {
                    <span class="site-value">
                      {{ getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'gm') ?? '' }}
                    </span>
                  }
                </td>
              }
            }
          </tr>
          <tr class="data-row cal-row">
            <td class="row-label-cell">NIC</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0">
                  <span class="site-value" [class]="getCALClass(getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'cal'))">
                    {{ getSiteNumericValue(getToothByNumber(tn)!, 'buccal', si, 'cal') ?? '' }}
                  </span>
                </td>
              }
            }
          </tr>
          <tr class="data-row bool-row">
            <td class="row-label-cell">Sangr.</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell bool-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  (click)="toggleBool(getToothByNumber(tn)!, 'buccal', si, 'bleeding')">
                  <span class="bool-dot"
                    [class.bleeding-active]="getSiteBoolValue(getToothByNumber(tn)!, 'buccal', si, 'bleeding')">
                  </span>
                </td>
              }
            }
          </tr>
          <tr class="data-row bool-row">
            <td class="row-label-cell">Exud.</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell bool-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  (click)="toggleBool(getToothByNumber(tn)!, 'buccal', si, 'suppuration')">
                  <span class="bool-dot"
                    [class.suppuration-active]="getSiteBoolValue(getToothByNumber(tn)!, 'buccal', si, 'suppuration')">
                  </span>
                </td>
              }
            }
          </tr>
          <!-- Mobility Row -->
          <tr class="data-row extra-row">
            <td class="row-label-cell">Movil.</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              <td colspan="3" class="tooth-extra-cell"
                [class.quadrant-divider-cell]="ti === 8">
                @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                  <input type="number" min="0" max="3"
                    class="extra-input"
                    [value]="getToothByNumber(tn)!.mobility"
                    (input)="onMobilityChange($event, getToothByNumber(tn)!)"/>
                } @else {
                  <span class="extra-value">{{ getToothByNumber(tn)?.mobility ?? '' }}</span>
                }
              </td>
            }
          </tr>
          <!-- Furcation Row -->
          <tr class="data-row extra-row">
            <td class="row-label-cell">Furca.</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              <td colspan="3" class="tooth-extra-cell"
                [class.quadrant-divider-cell]="ti === 8">
                @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                  <input type="number" min="0" max="3"
                    class="extra-input"
                    [value]="getToothByNumber(tn)!.furcation"
                    (input)="onFurcationChange($event, getToothByNumber(tn)!)"/>
                } @else {
                  <span class="extra-value">{{ getToothByNumber(tn)?.furcation ?? '' }}</span>
                }
              </td>
            }
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Lower Tooth Charts -->
    <div class="charts-between-tables">
      <div class="chart-surface-section">
        <span class="chart-label">Vestibular</span>
        <app-perio-tooth-chart
          [teeth]="teeth"
          [selectedTooth]="selectedTooth"
          surface="buccal"
          jaw="lower"
          (toothSelected)="toothSelected.emit($event)"/>
      </div>
      <div class="chart-surface-section">
        <span class="chart-label">Lingual</span>
        <app-perio-tooth-chart
          [teeth]="teeth"
          [selectedTooth]="selectedTooth"
          surface="lingual"
          jaw="lower"
          (toothSelected)="toothSelected.emit($event)"/>
      </div>
    </div>

    <!-- Lower Lingual Table -->
    <div class="surface-label">Lingual</div>
    <div class="grid-table-wrapper">
      <table class="grid-table">
        <thead>
          <tr class="tooth-numbers-row">
            <th class="row-label-cell"></th>
            @for (tn of LOWER_TEETH; track tn; let i = $index) {
              <th colspan="3" class="tooth-header"
                [class.quadrant-divider]="i === 8"
                [class.tooth-missing]="getToothByNumber(tn)?.isMissing">
                <span class="th-num">{{ tn }}</span>
              </th>
            }
          </tr>
        </thead>
        <tbody>
          <tr class="data-row">
            <td class="row-label-cell">PD</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  [class.active-cell]="isCellActive(ti, si, 'pd', 'lingual', 'lower')"
                  (click)="focusCell(ti, si, 'pd', 'lingual', 'lower')">
                  @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                    <input type="number" min="0" max="15"
                      class="site-input"
                      [class]="getPDClass(getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'pd'))"
                      [id]="getCellId('lower', 'lingual', ti, si, 'pd')"
                      [value]="getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'pd')"
                      (input)="onNumericInput($event, getToothByNumber(tn)!, 'lingual', si, 'pd')"
                      (focus)="focusCell(ti, si, 'pd', 'lingual', 'lower')"/>
                  } @else {
                    <span class="site-value" [class]="getPDClass(getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'pd'))">
                      {{ getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'pd') ?? '' }}
                    </span>
                  }
                </td>
              }
            }
          </tr>
          <tr class="data-row">
            <td class="row-label-cell">Margen</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  [class.active-cell]="isCellActive(ti, si, 'gm', 'lingual', 'lower')"
                  (click)="focusCell(ti, si, 'gm', 'lingual', 'lower')">
                  @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                    <input type="number" min="-10" max="10"
                      class="site-input"
                      [id]="getCellId('lower', 'lingual', ti, si, 'gm')"
                      [value]="getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'gm')"
                      (input)="onNumericInput($event, getToothByNumber(tn)!, 'lingual', si, 'gm')"
                      (focus)="focusCell(ti, si, 'gm', 'lingual', 'lower')"/>
                  } @else {
                    <span class="site-value">
                      {{ getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'gm') ?? '' }}
                    </span>
                  }
                </td>
              }
            }
          </tr>
          <tr class="data-row cal-row">
            <td class="row-label-cell">NIC</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0">
                  <span class="site-value" [class]="getCALClass(getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'cal'))">
                    {{ getSiteNumericValue(getToothByNumber(tn)!, 'lingual', si, 'cal') ?? '' }}
                  </span>
                </td>
              }
            }
          </tr>
          <tr class="data-row bool-row">
            <td class="row-label-cell">Sangr.</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell bool-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  (click)="toggleBool(getToothByNumber(tn)!, 'lingual', si, 'bleeding')">
                  <span class="bool-dot"
                    [class.bleeding-active]="getSiteBoolValue(getToothByNumber(tn)!, 'lingual', si, 'bleeding')">
                  </span>
                </td>
              }
            }
          </tr>
          <tr class="data-row bool-row">
            <td class="row-label-cell">Exud.</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              @for (si of [0,1,2]; track si) {
                <td class="site-cell bool-cell"
                  [class.quadrant-divider-cell]="ti === 8 && si === 0"
                  (click)="toggleBool(getToothByNumber(tn)!, 'lingual', si, 'suppuration')">
                  <span class="bool-dot"
                    [class.suppuration-active]="getSiteBoolValue(getToothByNumber(tn)!, 'lingual', si, 'suppuration')">
                  </span>
                </td>
              }
            }
          </tr>
          <!-- Mobility Row Lingual -->
          <tr class="data-row extra-row">
            <td class="row-label-cell">Movil.</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              <td colspan="3" class="tooth-extra-cell"
                [class.quadrant-divider-cell]="ti === 8">
                @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                  <input type="number" min="0" max="3"
                    class="extra-input"
                    [value]="getToothByNumber(tn)!.mobility"
                    (input)="onMobilityChange($event, getToothByNumber(tn)!)"/>
                } @else {
                  <span class="extra-value">{{ getToothByNumber(tn)?.mobility ?? '' }}</span>
                }
              </td>
            }
          </tr>
          <!-- Furcation Row Lingual -->
          <tr class="data-row extra-row">
            <td class="row-label-cell">Furca.</td>
            @for (tn of LOWER_TEETH; track tn; let ti = $index) {
              <td colspan="3" class="tooth-extra-cell"
                [class.quadrant-divider-cell]="ti === 8">
                @if (!readonly && !getToothByNumber(tn)?.isMissing) {
                  <input type="number" min="0" max="3"
                    class="extra-input"
                    [value]="getToothByNumber(tn)!.furcation"
                    (input)="onFurcationChange($event, getToothByNumber(tn)!)"/>
                } @else {
                  <span class="extra-value">{{ getToothByNumber(tn)?.furcation ?? '' }}</span>
                }
              </td>
            }
          </tr>
        </tbody>
      </table>
    </div>
  </section>
  }

</div>
