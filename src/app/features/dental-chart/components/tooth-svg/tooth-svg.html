<div
  class="tooth-wrapper"
  [class.selected]="selected()"
  [class.hovered]="hovered()"
  [class.absent]="isAbsent()"
  (click)="onClick()"
  (mouseenter)="onMouseEnter()"
  (mouseleave)="onMouseLeave()"
  [attr.aria-label]="fdi() + ' - ' + status()">

  <!-- Tooth Shape SVG -->
  <svg
    class="tooth-shape"
    [class.upper]="jaw() === 'upper'"
    [class.lower]="jaw() === 'lower'"
    viewBox="0 0 40 50"
    xmlns="http://www.w3.org/2000/svg">

    <!-- Roots -->
    <g class="roots-group" [class.absent-roots]="isAbsent()">
      @for (rootPath of shape().roots; track $index) {
        <path
          [attr.d]="rootPath"
          class="tooth-root"
          [class.implant-root]="isImplant()"/>
      }
    </g>

    <!-- Implant screw indicator -->
    @if (isImplant()) {
      @if (jaw() === 'upper') {
        <line x1="20" y1="28" x2="20" y2="46" class="implant-screw"/>
        <line x1="15" y1="32" x2="25" y2="32" class="implant-thread"/>
        <line x1="14" y1="36" x2="26" y2="36" class="implant-thread"/>
        <line x1="15" y1="40" x2="25" y2="40" class="implant-thread"/>
        <line x1="16" y1="44" x2="24" y2="44" class="implant-thread"/>
      } @else {
        <line x1="20" y1="22" x2="20" y2="4" class="implant-screw"/>
        <line x1="15" y1="18" x2="25" y2="18" class="implant-thread"/>
        <line x1="14" y1="14" x2="26" y2="14" class="implant-thread"/>
        <line x1="15" y1="10" x2="25" y2="10" class="implant-thread"/>
        <line x1="16" y1="6" x2="24" y2="6" class="implant-thread"/>
      }
    }

    <!-- Crown -->
    <path
      [attr.d]="shape().crown"
      class="tooth-crown"
      [attr.fill]="crownColor()"
      [class.crown-selected]="selected()"
      [class.crown-absent]="isAbsent()"/>

    <!-- Extracted X overlay -->
    @if (status() === 'Extracted') {
      @if (jaw() === 'upper') {
        <line x1="10" y1="6" x2="30" y2="24" class="extracted-x"/>
        <line x1="30" y1="6" x2="10" y2="24" class="extracted-x"/>
      } @else {
        <line x1="12" y1="26" x2="28" y2="46" class="extracted-x"/>
        <line x1="28" y1="26" x2="12" y2="46" class="extracted-x"/>
      }
    }

    <!-- Missing dashed overlay -->
    @if (status() === 'Missing') {
      <path
        [attr.d]="shape().crown"
        class="missing-outline"
        fill="none"/>
    }

    <!-- Condition overlays -->
    @if (conditions().includes('corona')) {
      @if (jaw() === 'upper') {
        <path d="M6,4 Q6,0 20,0 Q34,0 34,4 L34,8 L6,8 Z" class="condition-corona"/>
      } @else {
        <path d="M6,46 L34,46 L34,42 Q34,50 20,50 Q6,50 6,46 Z" class="condition-corona"/>
      }
    }

    @if (conditions().includes('endodoncia')) {
      @if (jaw() === 'upper') {
        <line x1="20" y1="8" x2="20" y2="24" class="condition-endo"/>
        <line x1="16" y1="8" x2="16" y2="20" class="condition-endo"/>
        <line x1="24" y1="8" x2="24" y2="20" class="condition-endo"/>
      } @else {
        <line x1="20" y1="26" x2="20" y2="42" class="condition-endo"/>
        <line x1="16" y1="30" x2="16" y2="42" class="condition-endo"/>
        <line x1="24" y1="30" x2="24" y2="42" class="condition-endo"/>
      }
    }

    @if (conditions().includes('sellante')) {
      @if (jaw() === 'upper') {
        <ellipse cx="20" cy="14" rx="7" ry="5" class="condition-sellante"/>
      } @else {
        <ellipse cx="20" cy="36" rx="7" ry="5" class="condition-sellante"/>
      }
    }

    @if (conditions().includes('ortodoncia')) {
      @if (jaw() === 'upper') {
        <rect x="14" y="11" width="12" height="6" rx="1" class="condition-bracket"/>
        <line x1="0" y1="14" x2="40" y2="14" class="condition-wire"/>
      } @else {
        <rect x="14" y="33" width="12" height="6" rx="1" class="condition-bracket"/>
        <line x1="0" y1="36" x2="40" y2="36" class="condition-wire"/>
      }
    }

    @if (conditions().includes('fractura')) {
      @if (jaw() === 'upper') {
        <polyline points="12,8 18,16 14,18 22,24" class="condition-fractura"/>
      } @else {
        <polyline points="12,42 18,34 14,32 22,26" class="condition-fractura"/>
      }
    }

    @if (conditions().includes('caries')) {
      @if (jaw() === 'upper') {
        <circle cx="20" cy="12" r="4" class="condition-caries"/>
      } @else {
        <circle cx="20" cy="38" r="4" class="condition-caries"/>
      }
    }

    @if (conditions().includes('puente')) {
      @if (jaw() === 'upper') {
        <line x1="-2" y1="3" x2="42" y2="3" class="condition-puente"/>
        <line x1="0" y1="3" x2="0" y2="8" class="condition-puente-post"/>
        <line x1="40" y1="3" x2="40" y2="8" class="condition-puente-post"/>
      } @else {
        <line x1="-2" y1="47" x2="42" y2="47" class="condition-puente"/>
        <line x1="0" y1="47" x2="0" y2="42" class="condition-puente-post"/>
        <line x1="40" y1="47" x2="40" y2="42" class="condition-puente-post"/>
      }
    }

    @if (conditions().includes('absceso')) {
      @if (jaw() === 'upper') {
        <circle cx="20" cy="42" r="4" class="condition-absceso"/>
        <circle cx="20" cy="42" r="2" class="condition-absceso-inner"/>
      } @else {
        <circle cx="20" cy="8" r="4" class="condition-absceso"/>
        <circle cx="20" cy="8" r="2" class="condition-absceso-inner"/>
      }
    }

    @if (conditions().includes('gingivitis')) {
      @if (jaw() === 'upper') {
        <path d="M4,24 Q10,21 14,24 Q18,27 22,24 Q26,21 30,24 Q34,27 38,24" class="condition-gingivitis"/>
      } @else {
        <path d="M4,26 Q10,23 14,26 Q18,29 22,26 Q26,23 30,26 Q34,29 38,26" class="condition-gingivitis"/>
      }
    }

    @if (conditions().includes('movilidad')) {
      @if (jaw() === 'upper') {
        <polyline points="2,14 6,10 2,6" class="condition-movilidad"/>
        <polyline points="38,14 34,10 38,6" class="condition-movilidad"/>
      } @else {
        <polyline points="2,40 6,36 2,32" class="condition-movilidad"/>
        <polyline points="38,40 34,36 38,32" class="condition-movilidad"/>
      }
    }

    @if (conditions().includes('protesis')) {
      @if (jaw() === 'upper') {
        <line x1="-4" y1="2" x2="44" y2="2" class="condition-protesis"/>
        <path d="M2,2 Q2,10 6,10" class="condition-protesis-hook"/>
        <path d="M38,2 Q38,10 34,10" class="condition-protesis-hook"/>
      } @else {
        <line x1="-4" y1="48" x2="44" y2="48" class="condition-protesis"/>
        <path d="M2,48 Q2,40 6,40" class="condition-protesis-hook"/>
        <path d="M38,48 Q38,40 34,40" class="condition-protesis-hook"/>
      }
    }

    @if (conditions().includes('perno')) {
      @if (jaw() === 'upper') {
        <line x1="20" y1="10" x2="20" y2="40" class="condition-perno"/>
        <circle cx="20" cy="10" r="2.5" class="condition-perno-head"/>
      } @else {
        <line x1="20" y1="40" x2="20" y2="10" class="condition-perno"/>
        <circle cx="20" cy="40" r="2.5" class="condition-perno-head"/>
      }
    }

    @if (conditions().includes('erosion')) {
      @if (jaw() === 'upper') {
        <line x1="12" y1="10" x2="28" y2="10" class="condition-erosion"/>
        <line x1="10" y1="14" x2="30" y2="14" class="condition-erosion"/>
        <line x1="12" y1="18" x2="28" y2="18" class="condition-erosion"/>
      } @else {
        <line x1="12" y1="32" x2="28" y2="32" class="condition-erosion"/>
        <line x1="10" y1="36" x2="30" y2="36" class="condition-erosion"/>
        <line x1="12" y1="40" x2="28" y2="40" class="condition-erosion"/>
      }
    }

    @if (conditions().includes('residuo_radicular')) {
      @if (jaw() === 'upper') {
        <path [attr.d]="shape().crown" class="condition-residuo" fill="none"/>
        <text x="20" y="16" text-anchor="middle" class="condition-residuo-text">RR</text>
      } @else {
        <path [attr.d]="shape().crown" class="condition-residuo" fill="none"/>
        <text x="20" y="38" text-anchor="middle" class="condition-residuo-text">RR</text>
      }
    }
  </svg>

  <!-- Mini Surface Diagram -->
  <svg
    class="surface-mini"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg">
    <!-- Vestibular/Buccal (top) -->
    <polygon
      points="4,1 20,1 17,7 7,7"
      [attr.fill]="getSurfaceColor('buccal')"
      class="mini-surface"/>
    <!-- Lingual (bottom) -->
    <polygon
      points="7,17 17,17 20,23 4,23"
      [attr.fill]="getSurfaceColor('lingual')"
      class="mini-surface"/>
    <!-- Mesial (left) -->
    <polygon
      points="1,3 7,7 7,17 1,21"
      [attr.fill]="getSurfaceColor('mesial')"
      class="mini-surface"/>
    <!-- Distal (right) -->
    <polygon
      points="17,7 23,3 23,21 17,17"
      [attr.fill]="getSurfaceColor('distal')"
      class="mini-surface"/>
    <!-- Occlusal (center) -->
    <rect
      x="7" y="7" width="10" height="10"
      [attr.fill]="getSurfaceColor('occlusal')"
      class="mini-surface"/>
  </svg>

  <!-- Tooth Number -->
  <span class="tooth-number">{{ fdi() }}</span>
</div>
