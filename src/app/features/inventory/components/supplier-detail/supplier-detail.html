<div class="detail-container">
  <app-page-header
    [title]="supplier() ? supplier()!.name : 'Proveedor'"
    [icon]="'fa-truck'"
    [showBackButton]="true"
    [breadcrumbs]="breadcrumbItems">
    <div actions>
      @if (supplier(); as sup) {
        <span class="status-badge" [class.badge-active]="sup.isActive" [class.badge-inactive]="!sup.isActive">
          {{ sup.isActive ? 'Activo' : 'Inactivo' }}
        </span>
        <button class="btn btn-icon" (click)="showAuditModal.set(true)" title="Auditoría">
          <i class="fa-solid fa-clock-rotate-left"></i>
        </button>
        <button class="btn btn-outline" (click)="editSupplier()">
          <i class="fa-solid fa-pen"></i>
          Editar
        </button>
      }
    </div>
  </app-page-header>

  @if (loading()) {
    <div class="loading-container">
      <i class="fa-solid fa-spinner fa-spin fa-2x"></i>
      <p>Cargando proveedor...</p>
    </div>
  }

  @if (error()) {
    <div class="empty-state">
      <i class="fa-solid fa-exclamation-triangle"></i>
      <h3>Error al cargar el proveedor</h3>
      <p>{{ error() }}</p>
      <button (click)="goBack()" class="btn btn-secondary">
        <i class="fa-solid fa-arrow-left"></i>
        Volver
      </button>
    </div>
  }

  @if (!loading() && !error() && supplier(); as sup) {
    <div class="detail-body">
      <div class="info-two-col">
        <div class="info-section">
          <h3>
            <i class="fa-solid fa-truck"></i>
            Información General
          </h3>
          <div class="info-card">
            <div class="info-row">
              <span class="info-label">Código:</span>
              <span class="info-value">{{ sup.code }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Nombre:</span>
              <span class="info-value">{{ sup.name }}</span>
            </div>
            @if (sup.taxId) {
              <div class="info-row">
                <span class="info-label">RFC:</span>
                <span class="info-value">{{ sup.taxId }}</span>
              </div>
            }
            <div class="info-row">
              <span class="info-label">Condiciones de pago:</span>
              <span class="info-value">{{ getPaymentTermLabel(sup.paymentTerms) }}</span>
            </div>
          </div>
        </div>

        <div class="info-section">
          <h3>
            <i class="fa-solid fa-address-book"></i>
            Contacto
          </h3>
          <div class="info-card">
            @if (sup.contactName) {
              <div class="info-row">
                <span class="info-label">Persona de contacto:</span>
                <span class="info-value">{{ sup.contactName }}</span>
              </div>
            }
            @if (sup.phone) {
              <div class="info-row">
                <span class="info-label">Teléfono:</span>
                <span class="info-value">{{ sup.phone }}</span>
              </div>
            }
            @if (sup.email) {
              <div class="info-row">
                <span class="info-label">Email:</span>
                <span class="info-value">{{ sup.email }}</span>
              </div>
            }
            @if (sup.address) {
              <div class="info-row">
                <span class="info-label">Dirección:</span>
                <span class="info-value">{{ sup.address }}</span>
              </div>
            }
            @if (!sup.contactName && !sup.phone && !sup.email && !sup.address) {
              <div class="info-empty">
                <i class="fa-solid fa-circle-info"></i>
                Sin información de contacto registrada
              </div>
            }
          </div>
        </div>
      </div>

      @if (sup.notes) {
        <div class="info-section">
          <h3>
            <i class="fa-solid fa-sticky-note"></i>
            Notas
          </h3>
          <div class="info-card">
            <div class="info-row">
              <span class="info-value">{{ sup.notes }}</span>
            </div>
          </div>
        </div>
      }
    </div>

    <app-audit-info
      [visible]="showAuditModal()"
      [createdAt]="sup.createdAt"
      (closed)="showAuditModal.set(false)"
    />
  }
</div>
