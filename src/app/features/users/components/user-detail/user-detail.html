<div class="user-detail-container">
  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Cargando usuario...</p>
    </div>
  }

  <!-- Error State -->
  @else if (error()) {
    <div class="error-container">
      <div class="error-icon">âš ï¸</div>
      <p class="error-message">{{ error() }}</p>
      <a routerLink="/users" class="btn btn-secondary">Volver a lista</a>
    </div>
  }

  <!-- User Detail -->
  @else if (user(); as currentUser) {
    <!-- Header with Actions -->
    <div class="detail-header">
      <div class="header-nav">
        <a routerLink="/users" class="back-link">
          â† Volver a usuarios
        </a>
      </div>
      <div class="header-actions">
        <a [routerLink]="['/users', currentUser.id, 'edit']" class="btn btn-primary">
          âœï¸ Editar
        </a>
        <button
          (click)="toggleUserActive()"
          class="btn"
          [class.btn-warning]="currentUser.isActive"
          [class.btn-success]="!currentUser.isActive"
        >
          {{ currentUser.isActive ? 'ğŸš« Desactivar' : 'âœ… Activar' }}
        </button>
      </div>
    </div>

    <!-- User Info Card -->
    <div class="info-card main-info">
      <div class="card-header">
        <div class="user-avatar">
          ğŸ‘¤
        </div>
        <div class="user-title">
          <h1 class="user-name">{{ currentUser.name }}</h1>
          <p class="user-email">{{ currentUser.email }}</p>
        </div>
        <div class="user-status-badge">
          @if (currentUser.isActive) {
            <span class="status-badge status-active">âœ… Activo</span>
          } @else {
            <span class="status-badge status-inactive">âŒ Inactivo</span>
          }
        </div>
      </div>
      
      <div class="card-body">
        <div class="info-grid">
          @if (currentUser.profile?.phoneNumber) {
            <div class="info-item">
              <span class="info-label">ğŸ“± TelÃ©fono</span>
              <span class="info-value">{{ currentUser.profile?.phoneNumber }}</span>
            </div>
          }
          
          @if (currentUser.profile?.specialty) {
            <div class="info-item">
              <span class="info-label">ğŸ©º Especialidad</span>
              <span class="info-value">{{ currentUser.profile?.specialty }}</span>
            </div>
          }
          
          @if (currentUser.profile?.professionalLicense) {
            <div class="info-item">
              <span class="info-label">ğŸ“œ CÃ©dula Profesional</span>
              <span class="info-value">{{ currentUser.profile?.professionalLicense }}</span>
            </div>
          }
          
          <div class="info-item">
            <span class="info-label">ğŸ“… Registrado</span>
            <span class="info-value">{{ currentUser.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Roles Card -->
    <div class="info-card">
      <div class="card-header">
        <h2 class="card-title">
          <span class="card-icon">ğŸ”‘</span>
          Roles Asignados
        </h2>
      </div>
      <div class="card-body">
        @if (currentUser.roles.length > 0) {
          <div class="roles-list">
            @for (role of currentUser.roles; track role.id) {
              <div class="role-item">
                <span [class]="'role-badge ' + getRoleBadgeClass(role.name)">
                  <span class="role-icon">{{ getRoleIcon(role.name) }}</span>
                  {{ role.name }}
                </span>
                @if (role.description) {
                  <p class="role-description">{{ role.description }}</p>
                }
              </div>
            }
          </div>
        } @else {
          <p class="empty-message">Sin roles asignados</p>
        }
      </div>
    </div>

    <!-- Permissions Card -->
    <div class="info-card">
      <div class="card-header">
        <h2 class="card-title">
          <span class="card-icon">ğŸ”</span>
          Permisos Efectivos
          <span class="permissions-count">{{ currentUser.permissions.length }}</span>
        </h2>
      </div>
      <div class="card-body">
        @if (currentUser.permissions.length > 0) {
          <div class="permissions-grid">
            @for (entry of groupPermissionsByCategory(currentUser.permissions) | keyvalue; track entry.key) {
              <div class="permission-group">
                <h3 class="group-title">{{ entry.key }}</h3>
                <div class="permissions-list">
                  @for (permission of entry.value; track permission) {
                    <span class="permission-chip">
                      âœ“ {{ permission.split('.')[1] }}
                    </span>
                  }
                </div>
              </div>
            }
          </div>
        } @else {
          <p class="empty-message">Sin permisos asignados</p>
        }
      </div>
    </div>

    <!-- Additional Profile Info -->
    @if (currentUser.profile?.address || currentUser.profile?.education || currentUser.profile?.bio) {
      <div class="info-card">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-icon">ğŸ’¼</span>
            InformaciÃ³n Adicional
          </h2>
        </div>
        <div class="card-body">
          <div class="additional-info">
            @if (currentUser.profile?.address) {
              <div class="info-block">
                <h4 class="info-block-title">ğŸ“ DirecciÃ³n</h4>
                <p class="info-block-content">{{ currentUser.profile?.address }}</p>
              </div>
            }
            
            @if (currentUser.profile?.education) {
              <div class="info-block">
                <h4 class="info-block-title">ğŸ“ EducaciÃ³n</h4>
                <p class="info-block-content">{{ currentUser.profile?.education }}</p>
              </div>
            }
            
            @if (currentUser.profile?.yearsOfExperience) {
              <div class="info-block">
                <h4 class="info-block-title">â±ï¸ Experiencia</h4>
                <p class="info-block-content">{{ currentUser.profile?.yearsOfExperience }} aÃ±os</p>
              </div>
            }
            
            @if (currentUser.profile?.bio) {
              <div class="info-block">
                <h4 class="info-block-title">ğŸ“ BiografÃ­a</h4>
                <p class="info-block-content">{{ currentUser.profile?.bio }}</p>
              </div>
            }
          </div>
        </div>
      </div>
    }
  }
</div>
