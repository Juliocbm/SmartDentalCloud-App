<div class="page-container container-wide">
  <app-page-header
    [title]="'Calendario de Citas'"
    [subtitle]="'Gestiona tus citas de forma visual'"
    [icon]="'fa-calendar-days'"
    [breadcrumbs]="breadcrumbItems">
    <div actions>
      <button 
        (click)="goToListView()"
        class="btn btn-outline"
        title="Vista de lista"
      >
        <i class="fa-solid fa-list"></i>
        Lista
      </button>
      
      <a 
        routerLink="/appointments/new"
        class="btn btn-outline btn-success"
      >
        <i class="fa-solid fa-plus"></i>
        Nueva Cita
      </a>
    </div>
  </app-page-header>

  @if (loading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Cargando calendario...</p>
    </div>
  } @else {
    <div class="calendar-wrapper">
      <div class="calendar-info">
        <div class="info-box">
          <i class="fa-solid fa-info-circle"></i>
          <span>Click en un espacio vacío para agendar. Click en una cita para ver detalles.</span>
        </div>

        <div class="calendar-filters">
          <div class="doctor-filter">
            <label for="doctorSelect">
              <i class="fa-solid fa-user-doctor"></i>
              Dentista
            </label>
            <select 
              id="doctorSelect"
              class="doctor-select"
              [value]="selectedDoctorId()"
              (change)="onDentistChange($any($event.target).value)"
            >
              <option value="all">Todos los dentistas</option>
              @for (dentist of dentists(); track dentist.id) {
                <option [value]="dentist.id">{{ dentist.name }}</option>
              }
            </select>
          </div>
          <app-location-selector
            [locationId]="selectedLocationId()"
            label="Sucursal"
            (locationChange)="onLocationChange($event)"
          />
        </div>
      </div>

      <div class="calendar-legend">
        <div class="legend">
          <span class="legend-title">Estados:</span>
          <span class="legend-item">
            <span class="color-dot dot-scheduled"></span>
            Programada
          </span>
          <span class="legend-item">
            <span class="color-dot dot-confirmed"></span>
            Confirmada
          </span>
          <span class="legend-item">
            <span class="color-dot dot-completed"></span>
            Completada
          </span>
          <span class="legend-item">
            <span class="color-dot dot-cancelled"></span>
            Cancelada
          </span>
          <span class="legend-item">
            <span class="color-dot dot-no-show"></span>
            No asistió
          </span>
          <span class="legend-separator">|</span>
          <span class="legend-item">
            <span class="color-dot dot-closed"></span>
            Cerrado
          </span>
          <span class="legend-item">
            <span class="color-dot dot-modified"></span>
            Horario Modificado
          </span>
        </div>
      </div>

      <div class="calendar-content">
        <full-calendar [options]="calendarOptions()"></full-calendar>
      </div>
    </div>
  }

  @if (showQuickCreateModal()) {
    <app-modal
      title="Nueva Cita"
      subtitle="Crear cita rápida desde el calendario"
      icon="fa-calendar-plus"
      size="sm"
      (closed)="closeModal()">

      <div class="slot-info">
        <div class="info-row">
          <i class="fa-solid fa-calendar"></i>
          <span>{{ selectedSlot()?.start | date:'EEEE, dd MMMM yyyy' }}</span>
        </div>
        <div class="info-row">
          <i class="fa-solid fa-clock"></i>
          <span>
            {{ selectedSlot()?.start | date:'HH:mm' }} - 
            {{ selectedSlot()?.end | date:'HH:mm' }}
          </span>
        </div>
      </div>

      <p class="help-text">
        Se abrirá el formulario completo con la fecha y hora preseleccionadas
      </p>

      <div modal-footer>
        <button type="button" class="btn btn-outline" (click)="closeModal()">
          <i class="fa-solid fa-times"></i>
          Cancelar
        </button>
        <button type="button" class="btn btn-outline btn-success" (click)="navigateToFullForm()">
          <i class="fa-solid fa-arrow-right"></i>
          Continuar
        </button>
      </div>
    </app-modal>
  }
</div>
