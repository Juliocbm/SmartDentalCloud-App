<div class="page-container container-wide">
  <app-page-header
    [title]="'Productividad por Dentista'"
    [subtitle]="'Rendimiento y métricas por profesional'"
    [icon]="'fa-user-doctor'"
    [breadcrumbs]="breadcrumbItems">
  </app-page-header>

  <div class="filters-section">
    <div class="filter-group">
      <label class="filter-label">Desde</label>
      <input type="date" class="form-control" [ngModel]="startDate()" (ngModelChange)="startDate.set($event); onDateChange()" />
    </div>
    <div class="filter-group">
      <label class="filter-label">Hasta</label>
      <input type="date" class="form-control" [ngModel]="endDate()" (ngModelChange)="endDate.set($event); onDateChange()" />
    </div>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <i class="fa-solid fa-spinner fa-spin fa-2x"></i>
      <p>Cargando reporte...</p>
    </div>
  } @else if (data().length === 0) {
    <div class="empty-state">
      <i class="fa-solid fa-user-doctor"></i>
      <h3>Sin datos</h3>
      <p>No hay datos de productividad para el período seleccionado.</p>
    </div>
  } @else {
    <div class="table-responsive">
      <table class="data-table">
        <thead>
          <tr>
            <th>Dentista</th>
            <th class="text-center">Citas Completadas</th>
            <th class="text-center">Citas Canceladas</th>
            <th class="text-center">Tratamientos</th>
            <th class="text-right">Ingresos</th>
            <th class="text-center">Duración Prom. (min)</th>
          </tr>
        </thead>
        <tbody>
          @for (d of data(); track d.dentistId) {
            <tr>
              <td class="dentist-name">
                <div class="dentist-avatar">
                  <i class="fa-solid fa-user-doctor"></i>
                </div>
                {{ d.dentistName }}
              </td>
              <td class="text-center">
                <span class="badge badge-success">{{ d.appointmentsCompleted }}</span>
              </td>
              <td class="text-center">
                <span class="badge badge-error">{{ d.appointmentsCancelled }}</span>
              </td>
              <td class="text-center">{{ d.treatmentsCompleted }}</td>
              <td class="text-right fw-semibold">{{ formatCurrency(d.revenueGenerated) }}</td>
              <td class="text-center">{{ d.avgAppointmentDuration }} min</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
