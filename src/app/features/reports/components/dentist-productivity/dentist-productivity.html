<div class="page-container container-wide">
  <app-page-header
    [title]="'Productividad por Dentista'"
    [subtitle]="'Rendimiento y métricas por profesional'"
    [icon]="'fa-user-doctor'"
    [showBackButton]="true"
    [breadcrumbs]="breadcrumbItems">
  </app-page-header>

  <!-- Date Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <label class="filter-label">Desde</label>
      <input type="date" class="form-control" [ngModel]="startDate()" (ngModelChange)="startDate.set($event); onDateChange()" />
    </div>
    <div class="filter-group">
      <label class="filter-label">Hasta</label>
      <input type="date" class="form-control" [ngModel]="endDate()" (ngModelChange)="endDate.set($event); onDateChange()" />
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container">
      <i class="fa-solid fa-spinner fa-spin fa-2x"></i>
      <p>Cargando reporte...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="empty-state">
      <i class="fa-solid fa-exclamation-triangle"></i>
      <p>{{ error() }}</p>
      <button class="btn btn-secondary" (click)="loadReport()">
        <i class="fa-solid fa-arrows-rotate"></i>
        Reintentar
      </button>
    </div>
  }

  <!-- Empty State -->
  @if (!loading() && !error() && data().length === 0) {
    <div class="empty-state">
      <i class="fa-solid fa-user-doctor"></i>
      <h3>Sin datos</h3>
      <p>No hay datos de productividad para el período seleccionado.</p>
    </div>
  }

  <!-- Table -->
  @if (!loading() && !error() && data().length > 0) {
    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>Dentista</th>
            <th class="text-center">Citas Completadas</th>
            <th class="text-center">Citas Canceladas</th>
            <th class="text-center">Tratamientos</th>
            <th class="text-right">Ingresos</th>
            <th class="text-center">Duración Prom. (min)</th>
          </tr>
        </thead>
        <tbody>
          @for (d of data(); track d.dentistId) {
            <tr>
              <td>
                <div class="dentist-cell">
                  <div class="dentist-cell__avatar">
                    <i class="fa-solid fa-user-doctor"></i>
                  </div>
                  <strong>{{ d.dentistName }}</strong>
                </div>
              </td>
              <td class="text-center">
                <span class="badge badge-success">{{ d.appointmentsCompleted }}</span>
              </td>
              <td class="text-center">
                <span class="badge badge-error">{{ d.appointmentsCancelled }}</span>
              </td>
              <td class="text-center">{{ d.treatmentsCompleted }}</td>
              <td class="text-right amount-cell">{{ formatCurrency(d.revenueGenerated) }}</td>
              <td class="text-center">{{ d.avgAppointmentDuration }} min</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
